<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book your healing journey</title>
    <link rel="stylesheet" href="appointement.css">
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500&family=Inter:wght@300;400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* recap box */
        #recap {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            font-family: Inter, sans-serif;
            display: none;
            /* cach√© par d√©faut */
        }

        #recap h3 {
            margin-bottom: 10px;
            color: #444;
        }

        #recap p {
            margin: 5px 0;
            font-size: 14px;
        }

        /* alert */
        .custom-alert {
            position: fixed;
            top: 20px;
            right: -300px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transition: all 0.5s ease;
            z-index: 9999;
        }

        .custom-alert.success {
            background: #4caf50;
        }

        .custom-alert.error {
            background: #f44336;
        }

        .custom-alert.show {
            right: 20px;
        }

        /* Your Information inputs */
        .client-info input {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: Inter, sans-serif;
        }

        /* bottom buttons */
        .bottom-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-bottom: 30px;
        }

        /* selecteurs calendrier */
        .calendar-header select {
            padding: 8px 10px;
            margin-right: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
            font-family: Inter, sans-serif;
            background-color: #fff;
            cursor: pointer;
        }

        .calendar-header select:focus {
            outline: none;
            border-color: #8b6f47;
        }

        /* Loader (spinner) */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            display: none;
        }

        .spinner {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #8b6f47;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="left-section">
            <div class="header-card">
                <h1>Book your healing journey</h1>
                <p>Make sure to put the right information to confirm your spot</p>
                <div class="warning">
                    <div class="warning-icon">!</div>
                    <span>All the rooms are built by recommendation!</span>
                </div>
            </div>

            <!-- Calendar -->
            <div>
                <h2 class="section-title">Choose a date</h2>
                <div class="calendar">
                    <div class="calendar-header">
                        <select id="monthSelect"></select>
                        <select id="yearSelect"></select>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <!-- Time slots -->
            <div>
                <h2 class="section-title">Pick a time</h2>
                <div class="time-slots">
                    <div class="time-grid">
                        <button class="time-slot">8:30</button>
                        <button class="time-slot">9:30</button>
                        <button class="time-slot">10:30</button>
                        <button class="time-slot">11:30</button>
                        <button class="time-slot">14:00</button>
                        <button class="time-slot">15:30</button>
                        <button class="time-slot">17:00</button>
                        <button class="time-slot">18:30</button>
                    </div>
                </div>
            </div>

            <div class="timezone-note">
                <div class="timezone-icon">üåç</div>
                <span>All Times are in Middle East Time - AUE</span>
            </div>
        </div>

        <!-- Right section -->
        <div class="right-section">

            <!-- Your Information -->
            <div class="client-info">
                <h2 class="section-title">Your Information</h2>
                <input type="text" id="userName" placeholder="Your Name" />
                <input type="email" id="userEmail" placeholder="Your Email" />
            </div>

            <div class="session-time">
                <h3>Total session time</h3>
                <div class="duration">
                    <div class="duration-icon">‚è±</div>
                    <div>
                        <div>Duration</div>
                        <div style="font-size: 12px;">30-40 mins</div>
                    </div>
                </div>
            </div>

            <!-- Rooms -->
            <div>
                <h2 class="section-title">Choose your class room</h2>

                <div class="room-card">
                    <div class="room-header">
                        <div>
                            <div class="room-title">The Moon Room</div>
                            <div class="room-subtitle">Reformer Pilates</div>
                        </div>
                        <button class="room-btn">Wanna flow?</button>
                    </div>
                    <div class="room-description">
                        Blast into stillness.<br>
                        Sculpt your upper body.
                    </div>
                </div>

                <div class="room-card">
                    <div class="room-header">
                        <div>
                            <div class="room-title">The Trees Room</div>
                            <div class="room-subtitle">Mat Pilates</div>
                        </div>
                        <button class="room-btn">Wanna align?</button>
                    </div>
                    <div class="room-description">
                        Ground down, Grow tall.<br>
                        Root your energy with lower body focus<br>
                        and work through into the last 30.
                    </div>
                </div>

                <div class="room-card">
                    <div class="room-header">
                        <div>
                            <div class="room-title">Sea Room</div>
                            <div class="room-subtitle">Private sessions</div>
                        </div>
                        <button class="room-btn">Wanna go solo?</button>
                    </div>
                    <div class="room-description">
                        You're never the same wave twice.<br>
                        Dynamic flow, healing, and designed to<br>
                        meet you exactly where you are.
                    </div>
                </div>
            </div>

            <!-- recap -->
            <div id="recap"></div>

            <!-- buttons -->
            <div class="bottom-buttons">
                <a href="index.html"> <button class="btn-secondary">Back</button></a>
                <button class="btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div class="loader-overlay" id="loader">
        <div class="spinner"></div>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

    <script>
        // Init EmailJS
        (function () {
            emailjs.init("TXBF0huI9dnKESSgj"); // ‚ö†Ô∏è Remplace par ta cl√© EmailJS
        })();

        const monthSelect = document.getElementById("monthSelect");
        const yearSelect = document.getElementById("yearSelect");
        const calendarGrid = document.getElementById("calendarGrid");
        const loader = document.getElementById("loader");

        let selectedDate = "";
        let selectedTime = "";
        let selectedRoom = "";

        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        // Initialiser mois et ann√©e
        months.forEach((m, i) => {
            const opt = document.createElement("option");
            opt.value = i;
            opt.textContent = m;
            monthSelect.appendChild(opt);
        });

        const currentYear = new Date().getFullYear();
        for (let y = currentYear - 1; y <= currentYear + 5; y++) {
            const opt = document.createElement("option");
            opt.value = y;
            opt.textContent = y;
            yearSelect.appendChild(opt);
        }

        monthSelect.value = new Date().getMonth();
        yearSelect.value = new Date().getFullYear();

        function renderCalendar(month, year) {
            calendarGrid.innerHTML = "";
            const daysOfWeek = ["M", "Tu", "W", "Th", "F", "Sa", "Su"];
            daysOfWeek.forEach(d => {
                const div = document.createElement("div");
                div.className = "day-header";
                div.textContent = d;
                calendarGrid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const offset = (firstDay + 6) % 7;

            for (let i = 0; i < offset; i++) {
                const empty = document.createElement("div");
                empty.className = "day";
                calendarGrid.appendChild(empty);
            }

            for (let d = 1; d <= daysInMonth; d++) {
                const div = document.createElement("div");
                div.className = "day";
                div.textContent = d;

                div.addEventListener("click", function () {
                    document.querySelectorAll('.day').forEach(el => el.classList.remove('selected'));
                    div.classList.add("selected");
                    selectedDate = `${d} ${months[month]} ${year}`;
                    updateRecap();
                });

                calendarGrid.appendChild(div);
            }
        }

        renderCalendar(parseInt(monthSelect.value), parseInt(yearSelect.value));
        monthSelect.addEventListener("change", () => renderCalendar(parseInt(monthSelect.value), parseInt(yearSelect.value)));
        yearSelect.addEventListener("change", () => renderCalendar(parseInt(monthSelect.value), parseInt(yearSelect.value)));

        // Time slots
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.addEventListener('click', function () {
                document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                this.classList.add('selected');
                selectedTime = this.textContent;
                updateRecap();
            });
        });

        // Rooms
        document.querySelectorAll('.room-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.room-card').forEach(card => {
                    card.style.border = 'none';
                    card.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
                });
                this.closest('.room-card').style.border = '2px solid #8b6f47';
                this.closest('.room-card').style.boxShadow = '0 4px 20px rgba(139,111,71,0.2)';
                selectedRoom = this.closest('.room-card').querySelector('.room-title').textContent;
                updateRecap();
            });
        });

        // Update recap
        function updateRecap() {
            const recap = document.getElementById("recap");
            const userName = document.getElementById("userName").value;
            const userEmail = document.getElementById("userEmail").value;

            if (!userName && !userEmail && !selectedRoom && !selectedDate && !selectedTime) {
                recap.style.display = "none";
                return;
            }

            recap.style.display = "block";
            recap.innerHTML = `
                <h3>üìù Your Choice</h3>
                <p><strong>Name:</strong> ${userName || "-"}</p>
                <p><strong>Email:</strong> ${userEmail || "-"}</p>
                <p><strong>Room:</strong> ${selectedRoom || "-"}</p>
                <p><strong>Date:</strong> ${selectedDate || "-"}</p>
                <p><strong>Time:</strong> ${selectedTime || "-"}</p>
            `;
        }

        document.getElementById("userName").addEventListener("input", updateRecap);
        document.getElementById("userEmail").addEventListener("input", updateRecap);

        // EmailJS send with loader
        document.querySelector('.btn-primary').addEventListener('click', function () {
            const userName = document.getElementById("userName").value;
            const userEmail = document.getElementById("userEmail").value;

            if (!userName || !userEmail || !selectedRoom || !selectedDate || !selectedTime) {
                showAlert("Please complete all fields before confirming.", "error");
                return;
            }

            const templateParams = {
                user_name: userName,
                user_email: userEmail,
                room: selectedRoom,
                date: selectedDate,
                time: selectedTime
            };

            loader.style.display = "flex"; // afficher le spinner

            emailjs.send("service_hds3wve", "template_ua82ugj", templateParams)
                .then(function () {
                    loader.style.display = "none"; // cacher le spinner
                    showAlert("Appointment confirmed & email sent!", "success");
                }, function () {
                    loader.style.display = "none"; // cacher le spinner
                    showAlert("‚ùå Failed to send email. Try again.", "error");
                });
        });

        // Alert
        function showAlert(message, type) {
            const alertBox = document.createElement("div");
            alertBox.className = `custom-alert ${type}`;
            alertBox.innerHTML = message;
            document.body.appendChild(alertBox);

            setTimeout(() => alertBox.classList.add("show"), 10);
            setTimeout(() => {
                alertBox.classList.remove("show");
                setTimeout(() => alertBox.remove(), 500);
            }, 3000);
        }
    </script>
</body>

</html>